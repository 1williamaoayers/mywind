# MyWind 股票订阅与智能投研系统设计报告

**报告日期**: 2025-12-28  
**报告类型**: 功能设计与实施计划书  
**版本**: v1.0

---

## 📋 目录

1. [需求分析](#需求分析)
2. [系统架构](#系统架构)
3. [功能模块设计](#功能模块设计)
4. [数据采集策略](#数据采集策略)
5. [API接口设计](#api接口设计)
6. [投研报告生成](#投研报告生成)
7. [技术实现方案](#技术实现方案)
8. [实施计划](#实施计划)

---

## 📊 需求分析

### 核心需求

| 需求 | 优先级 | 说明 |
|------|--------|------|
| 股票订阅管理 | P0 | 用户输入关注的股票列表 |
| 智能数据采集 | P0 | 根据订阅股票采集相关资讯 |
| 研报财报必采 | P0 | 研报、财报100%采集不过滤 |
| API服务 | P0 | 供外部软件调用 |
| 投研报告 | P1 | 每日自动生成投研日报 |

### 数据采集范围

```
股票订阅 ──┬── 新闻资讯（关键词匹配）
           ├── 研究报告（100%采集）
           ├── 财务报告（100%采集）
           ├── 公司公告（100%采集）
           ├── 资金流向（北水、主力）
           └── 社交舆情（微博、微信）
```

---

## 🏗️ 系统架构

### 整体架构图

```
┌─────────────────────────────────────────────────────────────┐
│                      前端界面层                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │  股票订阅    │  │  数据展示    │  │  报告阅读    │       │
│  └──────────────┘  └──────────────┘  └──────────────┘       │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      API服务层                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │ 订阅管理API  │  │ 数据查询API  │  │ 报告生成API  │       │
│  └──────────────┘  └──────────────┘  └──────────────┘       │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      业务逻辑层                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │ 订阅管理器   │  │ 数据过滤器   │  │ 报告生成器   │       │
│  └──────────────┘  └──────────────┘  └──────────────┘       │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      数据采集层                              │
│  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐    │
│  │ 新闻   │ │ 研报   │ │ 财报   │ │ 公告   │ │ 舆情   │    │
│  │ 采集器 │ │ 采集器 │ │ 采集器 │ │ 采集器 │ │ 采集器 │    │
│  └────────┘ └────────┘ └────────┘ └────────┘ └────────┘    │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      数据存储层                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │ MongoDB      │  │ Redis缓存    │  │ 文件存储     │       │
│  │ (结构化数据) │  │ (热点数据)   │  │ (PDF/报告)   │       │
│  └──────────────┘  └──────────────┘  └──────────────┘       │
└─────────────────────────────────────────────────────────────┘
```

---

## 📦 功能模块设计

### 模块一：股票订阅管理

#### 数据结构
```javascript
// 股票订阅信息
{
    userId: "user_001",
    subscriptions: [
        {
            stockCode: "600519",      // 股票代码
            stockName: "贵州茅台",    // 股票名称
            market: "SH",             // 市场（SH/SZ/HK/US）
            priority: "high",         // 优先级
            options: {
                news: true,           // 新闻资讯
                reports: true,        // 研究报告（必须）
                financials: true,     // 财务报告（必须）
                announcements: true,  // 公司公告（必须）
                sentiment: true       // 社交舆情
            },
            keywords: ["茅台", "白酒", "贵州茅台"],  // 额外关键词
            createdAt: "2025-12-28",
            updatedAt: "2025-12-28"
        }
    ]
}
```

#### 关键词生成规则
```javascript
// 根据股票自动生成关键词
function generateKeywords(stock) {
    const keywords = new Set();
    
    // 基础关键词
    keywords.add(stock.stockCode);           // 600519
    keywords.add(stock.stockName);           // 贵州茅台
    keywords.add(stock.shortName);           // 茅台
    
    // 行业关键词
    if (stock.industry) {
        keywords.add(stock.industry);        // 白酒
    }
    
    // 概念板块
    if (stock.concepts) {
        stock.concepts.forEach(c => keywords.add(c));
    }
    
    // 高管姓名（可选）
    if (stock.executives) {
        stock.executives.forEach(e => keywords.add(e));
    }
    
    return Array.from(keywords);
}
```

### 模块二：智能数据采集

#### 采集策略矩阵

| 数据类型 | 采集频率 | 过滤规则 | 存储策略 |
|----------|----------|----------|----------|
| 新闻资讯 | 15分钟 | 关键词匹配 | 7天热存储 |
| 研究报告 | 6小时 | **无过滤** | 永久存储 |
| 财务报告 | 每日 | **无过滤** | 永久存储 |
| 公司公告 | 1小时 | **无过滤** | 永久存储 |
| 资金流向 | 30分钟 | 订阅股票 | 30天存储 |
| 社交舆情 | 30分钟 | 关键词+热度 | 3天存储 |

#### 优先级采集规则
```javascript
const COLLECTION_PRIORITY = {
    // 必须采集（不过滤）
    mustCollect: ['report', 'financial', 'announcement'],
    
    // 优先采集（宽松过滤）
    highPriority: ['news', 'flow'],
    
    // 普通采集（严格过滤）
    normalPriority: ['sentiment']
};
```

### 模块三：数据过滤增强

#### 订阅股票专属过滤器
```javascript
class SubscriptionFilter extends DataFilter {
    constructor(subscriptions) {
        super();
        this.subscriptions = subscriptions;
        this.stockKeywords = this.buildKeywordIndex();
    }
    
    // 构建关键词索引
    buildKeywordIndex() {
        const index = new Map();
        for (const sub of this.subscriptions) {
            for (const kw of sub.keywords) {
                if (!index.has(kw)) {
                    index.set(kw, []);
                }
                index.get(kw).push(sub.stockCode);
            }
        }
        return index;
    }
    
    // 检查是否与订阅股票相关
    isRelatedToSubscription(text) {
        for (const [keyword, stocks] of this.stockKeywords) {
            if (text.includes(keyword)) {
                return { related: true, stocks };
            }
        }
        return { related: false, stocks: [] };
    }
    
    // 增强过滤逻辑
    filter(item) {
        // 研报、财报、公告不过滤
        if (['report', 'financial', 'announcement'].includes(item.type)) {
            const relation = this.isRelatedToSubscription(item.title);
            if (relation.related) {
                return { keep: true, score: 100, stocks: relation.stocks };
            }
        }
        
        // 其他内容正常过滤
        return super.filter(item);
    }
}
```

---

## 🔌 API接口设计

### RESTful API 规范

#### 1. 订阅管理

```
POST   /api/v1/subscriptions          # 添加订阅
GET    /api/v1/subscriptions          # 获取订阅列表
PUT    /api/v1/subscriptions/:code    # 更新订阅
DELETE /api/v1/subscriptions/:code    # 删除订阅
```

#### 2. 数据查询

```
GET    /api/v1/news                   # 获取新闻
GET    /api/v1/reports                # 获取研报
GET    /api/v1/financials             # 获取财报
GET    /api/v1/announcements          # 获取公告
GET    /api/v1/flow                   # 获取资金流向
GET    /api/v1/sentiment              # 获取舆情数据
```

#### 3. 股票专属数据

```
GET    /api/v1/stocks/:code/news      # 获取股票新闻
GET    /api/v1/stocks/:code/reports   # 获取股票研报
GET    /api/v1/stocks/:code/timeline  # 获取股票时间线
GET    /api/v1/stocks/:code/summary   # 获取股票摘要
```

#### 4. 投研报告

```
GET    /api/v1/daily-report           # 获取每日投研报告
GET    /api/v1/weekly-report          # 获取每周投研报告
POST   /api/v1/reports/generate       # 手动生成报告
```

### API响应格式

```javascript
// 成功响应
{
    "success": true,
    "data": { ... },
    "meta": {
        "total": 100,
        "page": 1,
        "pageSize": 20
    }
}

// 错误响应
{
    "success": false,
    "error": {
        "code": "INVALID_STOCK_CODE",
        "message": "股票代码格式错误"
    }
}
```

### WebSocket实时推送

```javascript
// 实时数据推送
ws.on('news', (data) => {
    // 新新闻推送
});

ws.on('alert', (data) => {
    // 重大事件告警
});

ws.on('report', (data) => {
    // 新研报推送
});
```

---

## 📝 投研报告生成

### 报告结构

```markdown
# 每日投研日报
日期：2025-12-28

## 一、市场概览
- 上证指数：3XXX.XX (+0.5%)
- 深证成指：1XXXX.XX (+0.3%)
- 恒生指数：2XXXX.XX (-0.2%)

## 二、关注股票动态

### 600519 贵州茅台
#### 今日资讯（3条）
- [重要] 茅台发布2024年业绩预告...
- 白酒板块持续走强...
- ...

#### 最新研报（1份）
- 《贵州茅台：24年业绩符合预期》- 中信证券

#### 资金流向
- 主力净流入：+2.5亿
- 北水持仓变化：+0.1%

### 000001 平安银行
...

## 三、重点研报摘要
1. 《2025年A股投资策略》- 兴业证券
   - 核心观点：...
   
2. 《新能源行业深度报告》- 国泰君安
   - 核心观点：...

## 四、舆情监控
- 微博热搜：#A股# 今日讨论热度...
- 异常舆情：无

## 五、明日关注
- 待发布财报：XXX、XXX
- 重大事件：XXX

---
*本报告由MyWind智能投研系统自动生成*
```

### 报告生成流程

```
定时触发(每日18:00) 
    │
    ▼
收集当日数据 ──→ 按股票分组 ──→ 生成摘要 ──→ 排版输出
    │                                              │
    └── 新闻、研报、公告、资金 ──────────────────────┘
```

---

## 🛠️ 技术实现方案

### 新建文件清单

| 文件 | 功能 |
|------|------|
| `services/subscriptionManager.js` | 订阅管理器 |
| `services/stockCollector.js` | 股票数据采集器 |
| `services/reportGenerator.js` | 报告生成器 |
| `api/routes/subscriptions.js` | 订阅API路由 |
| `api/routes/stocks.js` | 股票API路由 |
| `api/routes/reports.js` | 报告API路由 |
| `utils/stockKeywords.js` | 股票关键词工具 |
| `scripts/dailyReport.js` | 每日报告生成脚本 |

### 数据存储设计

```javascript
// MongoDB Collections

// 1. 订阅表
db.subscriptions: {
    userId: String,
    stockCode: String,
    stockName: String,
    market: String,
    keywords: [String],
    options: Object,
    createdAt: Date
}

// 2. 股票资讯表
db.stockNews: {
    stockCode: String,
    title: String,
    content: String,
    source: String,
    type: String,  // news/report/financial/announcement
    url: String,
    publishTime: Date,
    score: Number,
    createdAt: Date
}

// 3. 投研报告表
db.investReports: {
    reportDate: Date,
    type: String,  // daily/weekly
    content: String,
    stocks: [String],
    generatedAt: Date
}
```

---

## 📅 实施计划

### 第一阶段：基础功能（3天）

| 天数 | 任务 | 交付物 |
|------|------|--------|
| Day 1 | 订阅管理模块 | `subscriptionManager.js` |
| Day 2 | 股票关键词生成 | `stockKeywords.js` |
| Day 3 | 增强过滤器 | 更新 `dataFilter.js` |

### 第二阶段：数据采集（3天）

| 天数 | 任务 | 交付物 |
|------|------|--------|
| Day 4 | 股票数据采集器 | `stockCollector.js` |
| Day 5 | 研报财报采集优化 | 更新相关爬虫 |
| Day 6 | 集成测试 | 测试报告 |

### 第三阶段：API服务（3天）

| 天数 | 任务 | 交付物 |
|------|------|--------|
| Day 7 | 订阅API | `api/routes/subscriptions.js` |
| Day 8 | 数据查询API | `api/routes/stocks.js` |
| Day 9 | API文档 | Swagger文档 |

### 第四阶段：投研报告（2天）

| 天数 | 任务 | 交付物 |
|------|------|--------|
| Day 10 | 报告生成器 | `reportGenerator.js` |
| Day 11 | 定时任务 | `dailyReport.js` |

---

## 📊 预期效果

### 数据效率

| 指标 | 无订阅 | 有订阅 | 提升 |
|------|--------|--------|------|
| 日采集量 | 5000条 | 500条 | -90% |
| 数据相关性 | 30% | 95% | +217% |
| 研报覆盖率 | 10% | 100% | +900% |

### 用户价值

| 功能 | 价值 |
|------|------|
| 定制化采集 | 只看关注的股票 |
| 研报必达 | 不遗漏任何研报 |
| 每日日报 | 快速了解持仓动态 |
| API接入 | 对接分析系统 |

---

## 🚀 下一步行动

1. **确认需求** - 请确认此设计是否符合预期
2. **开始实施** - 批准后立即开始第一阶段
3. **迭代优化** - 根据使用反馈持续优化

---

*报告生成时间: 2025-12-28 11:10*
