# AkShareæ›´æ–°æœºåˆ¶è°ƒç ”ä¸MyWindè‡ªåŠ¨è·Ÿè¿›æ–¹æ¡ˆ

> **è°ƒç ”æ—¥æœŸ**: 2026-01-06  
> **è°ƒç ”ç›®çš„**: ç ”ç©¶AkShareçš„æ›´æ–°é¢‘ç‡å’Œæœºåˆ¶ï¼Œæå‡ºMyWindå¦‚ä½•æ›´å®¹æ˜“ã€æ›´ç®€å•åœ°è·Ÿä¸ŠAkShareæ›´æ–°çš„æ–¹æ¡ˆ  
> **è°ƒç ”æ–¹æ³•**: å®˜æ–¹æ–‡æ¡£é€å­—å®¡æŸ¥ + GitHubä»“åº“åˆ†æ + å…¨ç½‘æœ€ä½³å®è·µç ”ç©¶

---

## ğŸ“Š è°ƒç ”å‘ç°

### 1. A kShareæ›´æ–°é¢‘ç‡åˆ†æ âš ï¸ **å…³é”®å‘ç°**

**å®˜æ–¹GitHubæ•°æ®**:
- **æ€»ç‰ˆæœ¬æ•°**: 129ä¸ªç‰ˆæœ¬ï¼ˆæˆªè‡³2026-01-06ï¼‰
- **æœ€æ–°ç‰ˆæœ¬**: v1.18.7 (2026-01-05å‘å¸ƒ)
- **æ›´æ–°é¢‘ç‡**: **å‡ ä¹æ¯å¤©æ›´æ–°ï¼Œç”šè‡³ä¸€å¤©å¤šæ¬¡**
  - ä¾‹å¦‚ï¼šv1.18.7ï¼ˆ1å°æ—¶å‰ï¼‰å’Œv1.18.6ï¼ˆ11å°æ—¶å‰ï¼‰åœ¨åŒä¸€å¤©å‘å¸ƒ
- **æ´»è·ƒç¨‹åº¦**: æœ€è¿‘æäº¤ï¼ˆ2026-01-04ï¼‰æ˜¾ç¤ºæŒç»­å¼€å‘

**æ›´æ–°åŸå› **ï¼ˆæ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼‰:
1. **æ•°æ®æºå˜åŒ–**: ç›®æ ‡ç½‘ç«™ï¼ˆä¸œæ–¹è´¢å¯Œã€æ–°æµªè´¢ç»ç­‰ï¼‰é¢‘ç¹è°ƒæ•´ç»“æ„
2. **Bugä¿®å¤**: åŠæ—¶ä¿®å¤æ¥å£å¤±æ•ˆé—®é¢˜
3. **æ–°æ¥å£æ·»åŠ **: æŒç»­å¢åŠ æ–°çš„æ•°æ®æ¥å£
4. **æºç ä¼˜åŒ–**: ä»£ç è´¨é‡å’Œæ€§èƒ½æ”¹è¿›

**å®˜æ–¹å»ºè®®**: 
> ç”¨æˆ·åº”**é¢‘ç¹æ›´æ–°**æœ¬åœ°AkShareåˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œå› ä¸ºæ•°æ®æºç½‘ç«™çš„å˜åŒ–ä¼šå¯¼è‡´æ¥å£éœ€è¦è°ƒæ•´

---

### 2. AkShareç»´æŠ¤ç‰¹ç‚¹

#### 2.1 é«˜é¢‘è¿­ä»£çš„åŸå› 
- âŒ **çˆ¬è™«ç‰¹æ€§**: AkShareæœ¬è´¨æ˜¯web scrapingåº“ï¼Œä¾èµ–ç›®æ ‡ç½‘ç«™HTMLç»“æ„
- âš ï¸ **CSSé€‰æ‹©å™¨æ˜“å¤±æ•ˆ**: ç½‘ç«™ä¸€æ”¹ç‰ˆï¼Œæ¥å£å°±å¯èƒ½å¤±æ•ˆ
- âœ… **å¿«é€Ÿå“åº”**: ä½œè€…å›¢é˜Ÿèƒ½å¿«é€Ÿä¿®å¤ï¼ˆé€šå¸¸å½“å¤©æˆ–æ¬¡æ—¥ï¼‰
- ğŸ”„ **æŒç»­ç»´æŠ¤**: ä½œè€…æ‰¿è¯ºé•¿æœŸç»´æŠ¤ï¼Œç¡®ä¿æ•°æ®å¯é æ€§

#### 2.2 ç‰ˆæœ¬å‘å¸ƒç­–ç•¥
- **Semantic Versioning**: éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆmajor.minor.patchï¼‰
- **è¯¦ç»†Changelog**: æ¯ä¸ªç‰ˆæœ¬éƒ½æœ‰è¯¦ç»†çš„å˜æ›´æ—¥å¿—
- **å‘åå…¼å®¹**: å¤§éƒ¨åˆ†æ›´æ–°ä¿æŒAPIå‘åå…¼å®¹
- **Breaking Changes**: é‡å¤§å˜æ›´ä¼šåœ¨release notesä¸­æ˜ç¡®æ ‡æ³¨

---

## âš ï¸ é—®é¢˜åˆ†æï¼šå¦‚æœæˆ‘ä»¬ä¸è·Ÿè¿›æ›´æ–°ä¼šæ€æ ·ï¼Ÿ

### é£é™©è¯„ä¼°

| é£é™© | å¯èƒ½æ€§ | å½±å“ | è¯´æ˜ |
|------|--------|------|------|
| æ¥å£å¤±æ•ˆ | â­â­â­â­â­ æé«˜ | ğŸ”´ ä¸¥é‡ | æ•°æ®æºç½‘ç«™æ”¹ç‰ˆâ†’æ¥å£å¤±æ•ˆâ†’MyWind APIè¿”å›ç©ºæ•°æ® |
| æ–°æ¥å£ç¼ºå¤± | â­â­â­â­ é«˜ | ğŸŸ¡ ä¸­ç­‰ | é”™è¿‡æ–°åŠŸèƒ½ï¼ŒTradingAgentsæ— æ³•è·å–æ–°ç±»å‹æ•°æ® |
| æ€§èƒ½é—®é¢˜ | â­â­â­ ä¸­ç­‰ | ğŸŸ¡ ä¸­ç­‰ | æ—§ç‰ˆæœ¬å¯èƒ½æœ‰æ€§èƒ½bugï¼Œå½±å“å“åº”æ—¶é—´ |
| å®‰å…¨æ¼æ´ | â­â­ ä½ | ğŸŸ  é«˜ | ä¾èµ–åº“æ¼æ´ï¼ˆrequestsã€pandasç­‰ï¼‰|

### å…¸å‹å¤±æ•ˆåœºæ™¯
**ç¤ºä¾‹**ï¼ˆçœŸå®æƒ…å†µï¼‰:
1. ä¸œæ–¹è´¢å¯Œç½‘ä¿®æ”¹äº†æ–°é—»åˆ—è¡¨é¡µçš„CSSç±»å
2. AkShareçš„`stock_news_em()`æ¥å£å¤±æ•ˆ
3. ä½œè€…å½“å¤©å‘ç°å¹¶ä¿®å¤ï¼Œå‘å¸ƒv1.18.6
4. å¦‚æœMyWindæ²¡æ›´æ–° â†’ æ–°é—»åˆ†æå¸ˆå®Œå…¨å¤±æ•ˆï¼

---

## âœ… è§£å†³æ–¹æ¡ˆï¼šMyWindè‡ªåŠ¨è·Ÿè¿›ç­–ç•¥

### æ–¹æ¡ˆAï¼šæ¿€è¿›æ›´æ–°ç­–ç•¥ â­ æ¨èï¼ˆéç”Ÿäº§ç¯å¢ƒï¼‰

**é€‚ç”¨åœºæ™¯**: å¼€å‘é˜¶æ®µã€æµ‹è¯•ç¯å¢ƒ

**ç­–ç•¥**: æ¯å‘¨è‡ªåŠ¨æ›´æ–°AkShareåˆ°æœ€æ–°ç‰ˆæœ¬

**å®æ–½æ­¥éª¤**:

```yaml
# Dockerfile æˆ– requirements.txt
# æ–¹å¼1ï¼šrequirements.txtï¼ˆä¸é”å®šç‰ˆæœ¬ï¼‰
akshare>=1.18.0  # åªæŒ‡å®šæœ€ä½ç‰ˆæœ¬

# æ–¹å¼2ï¼šå®šæœŸé‡æ–°ç”Ÿæˆrequirements.txt
akshare==1.18.7  # æ¯å‘¨æ›´æ–°è¿™ä¸ªç‰ˆæœ¬å·
```

**è‡ªåŠ¨åŒ–æµç¨‹**ï¼ˆGitHub Actions / Cron Jobï¼‰:
```yaml
# .github/workflows/update-akshare.yml
name: Update AkShare Weekly
on:
  schedule:
    - cron: '0 0 * * 0'  # æ¯å‘¨æ—¥00:00
  workflow_dispatch:  # ä¹Ÿå¯æ‰‹åŠ¨è§¦å‘

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Update AkShare to latest
        run: |
          pip install akshare --upgrade
          pip freeze | grep akshare > akshare-version.txt
          
      - name: Run integration tests
        run: |
          pytest tests/akshare_integration/
          
      - name: Create Pull Request
        if: success()
        uses: peter-evans/create-pull-request@v5
        with:
          title: "chore: Update AkShare to latest version"
          body: "Auto-generated PR to update AkShare dependency"
```

**ä¼˜ç‚¹**:
- âœ… å§‹ç»ˆä½¿ç”¨æœ€æ–°æ¥å£
- âœ… è‡ªåŠ¨è·å¾—bugä¿®å¤
- âœ… ä¸ä¼šè½åå¤ªå¤š

**ç¼ºç‚¹**:
- âš ï¸ å¯èƒ½å¼•å…¥breaking changes
- âš ï¸ éœ€è¦å®Œå–„çš„è‡ªåŠ¨åŒ–æµ‹è¯•

---

### æ–¹æ¡ˆBï¼šä¿å®ˆæ›´æ–°ç­–ç•¥ â­â­ æ¨èï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

**é€‚ç”¨åœºæ™¯**: ç”Ÿäº§ç¯å¢ƒã€å¯¹ç¨³å®šæ€§è¦æ±‚é«˜çš„åœºæ™¯

**ç­–ç•¥**: ç‰ˆæœ¬é”å®š + å®šæœŸæ‰‹åŠ¨æ›´æ–° + å……åˆ†æµ‹è¯•

**å®æ–½æ­¥éª¤**:

#### Step 1: ä½¿ç”¨Poetryç®¡ç†ä¾èµ–ï¼ˆæ¨èï¼‰

```toml
#  pyproject.toml
[tool.poetry.dependencies]
python = "^3.11"
akshare = "1.18.7"  # é”å®šç²¾ç¡®ç‰ˆæœ¬
fastapi = "^0.109.0"
redis = "^5.0.0"
```

```bash
# ç”Ÿæˆlockfile
poetry lock

# å®‰è£…ç¡®åˆ‡ç‰ˆæœ¬
poetry install
```

#### Step 2: ç›‘æ§AkShareæ›´æ–°

**æ–¹å¼1: GitHub Watch**
- åœ¨GitHubä¸ŠWatch AkShareä»“åº“
- é€‰æ‹©"Releases only"
- æ¯æ¬¡å‘å¸ƒä¼šæ”¶åˆ°é‚®ä»¶é€šçŸ¥

**æ–¹å¼2: RSSè®¢é˜…**
```
https://github.com/akfamily/akshare/releases.atom
```

**æ–¹å¼3: è‡ªåŠ¨åŒ–ç›‘æ§è„šæœ¬**
```python
# scripts/check_akshare_version.py
import requests
import subprocess

def get_latest_version():
    """ä»PyPIè·å–æœ€æ–°ç‰ˆæœ¬"""
    response = requests.get("https://pypi.org/pypi/akshare/json")
    return response.json()["info"]["version"]

def get_current_version():
    """è·å–å½“å‰å®‰è£…ç‰ˆæœ¬"""
    result = subprocess.run(
        ["poetry", "show", "akshare"],
        capture_output=True,
        text=True
    )
    # è§£æè¾“å‡ºè·å–ç‰ˆæœ¬
    for  line in result.stdout.split("\n"):
        if line.startswith("version"):
            return line.split(":")[1].strip()

if __name__ == "__main__":
    latest = get_latest_version()
    current = get_current_version()
    
    if latest != current:
        print(f"âš ï¸ New AkShare version available: {latest} (current: {current})")
        print(f"ğŸ“‹ Changelog: https://github.com/akfamily/akshare/releases/tag/release-v{latest}")
    else:
        print(f"âœ… AkShare is up to date: {current}")
```

æ¯å¤©é€šè¿‡cronè¿è¡Œï¼Œå‘ç°æ–°ç‰ˆæœ¬æ—¶å‘é€é€šçŸ¥ã€‚

#### Step 3: æ›´æ–°æµç¨‹ï¼ˆæ¯2å‘¨ä¸€æ¬¡ï¼‰

```bash
# 1. åˆ›å»ºæ›´æ–°åˆ†æ”¯
git checkout -b update-akshare-v1.18.8

# 2. æ›´æ–°AkShare
poetry add akshare@^1.18.8

# 3. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
poetry run pytest tests/ -v

# 4. æ‰‹åŠ¨æµ‹è¯•å…³é”®æ¥å£
poetry run python scripts/test_critical_apis.py

# 5. æ£€æŸ¥changelog
# é˜…è¯» https://github.com/akfamily/akshare/releases

# 6. å¦‚æœæµ‹è¯•é€šè¿‡ï¼Œæäº¤PR
git commit -am "chore: update akshare to v1.18.8"
git push origin update-akshare-v1.18.8
```

**ä¼˜ç‚¹**:
- âœ… ç¨³å®šæ€§é«˜ï¼Œä¸ä¼šçªç„¶å¤±æ•ˆ
- âœ… æœ‰å……åˆ†æµ‹è¯•æ—¶é—´
- âœ… å¯ä»¥è¯„ä¼°breaking changes

**ç¼ºç‚¹**:
- âš ï¸ å¯èƒ½è½åæœ€æ–°ç‰ˆæœ¬1-2å‘¨
- âš ï¸ å¦‚æœå…³é”®æ¥å£å¤±æ•ˆéœ€è¦ç´§æ€¥æ›´æ–°

---

### æ–¹æ¡ˆCï¼šæ··åˆç­–ç•¥ â­â­â­ æœ€ä½³æ¨è

**ç­–ç•¥**: å¼€å‘ç¯å¢ƒæ¿€è¿›æ›´æ–° + ç”Ÿäº§ç¯å¢ƒä¿å®ˆæ›´æ–° + ç´§æ€¥çƒ­ä¿®å¤æœºåˆ¶

**æ¶æ„**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Development Environment             â”‚
â”‚  - AkShare: latest (æ¯å‘¨è‡ªåŠ¨æ›´æ–°)             â”‚
â”‚  - æŒç»­é›†æˆæµ‹è¯•                               â”‚
â”‚  - å‘ç°é—®é¢˜ç«‹å³å›æ»š                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ æµ‹è¯•é€šè¿‡ï¼ˆ1å‘¨åï¼‰
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Staging Environment                  â”‚
â”‚  - AkShare: é”å®šç‰ˆæœ¬ï¼ˆå¼€å‘ç¯å¢ƒéªŒè¯è¿‡çš„ç‰ˆæœ¬ï¼‰   â”‚
â”‚  - å®Œæ•´å›å½’æµ‹è¯•                               â”‚
â”‚  - æ€§èƒ½æµ‹è¯•                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ æµ‹è¯•é€šè¿‡ï¼ˆ3å¤©åï¼‰
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Production Environment               â”‚
â”‚  - AkShare: ä¸¥æ ¼é”å®šç‰ˆæœ¬                      â”‚
â”‚  - åªåœ¨å……åˆ†éªŒè¯åæ›´æ–°                         â”‚
â”‚  - æœ‰rollback plan                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            âš¡ ç´§æ€¥çƒ­ä¿®å¤é€šé“ âš¡
     ï¼ˆå…³é”®æ¥å£å¤±æ•ˆæ—¶è·³è¿‡stagingç›´è¾¾ç”Ÿäº§ï¼‰
```

**ç´§æ€¥æ›´æ–°æœºåˆ¶**:
```python
# services/akshare_health_checker.py
"""
æ¯å°æ—¶æ£€æŸ¥å…³é”®æ¥å£å¥åº·çŠ¶æ€
"""
import akshare as ak
from datetime import datetime

CRITICAL_APIS = [
    ("stock_hk_spot_em", {}),  # æ¸¯è‚¡å®æ—¶è¡Œæƒ…
    ("stock_news_em", {"symbol": "BK0001"}),  # æ–°é—»
    ("macro_china_gdp", {}),  # GDPæ•°æ®
]

def check_api_health(func_name, params):
    """æ£€æŸ¥å•ä¸ªAPIæ˜¯å¦æ­£å¸¸"""
    try:
        func = getattr(ak, func_name)
        result = func(**params)
        return len(result) > 0  # è‡³å°‘è¿”å›æ•°æ®
    except Exception as e:
        return False

def health_check():
    failed = []
    for func_name, params in CRITICAL_APIS:
        if not check_api_health(func_name, params):
            failed.append(func_name)
    
    if failed:
        # å‘é€å‘Šè­¦
        send_alert(f"âš ï¸ Critical AkShare APIs failed: {failed}")
        # æ£€æŸ¥æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬
        check_and_suggest_update()
```

---

## ğŸ› ï¸ æŠ€æœ¯å®æ–½ç»†èŠ‚

### 1. ä¾èµ–ç®¡ç†å·¥å…·é€‰æ‹©

**æ¨èï¼šPoetry** â­â­â­

**ç†ç”±**:
1. âœ… è‡ªåŠ¨ç®¡ç†è™šæ‹Ÿç¯å¢ƒ
2. âœ… `pyproject.toml` + `poetry.lock` åŒé‡ä¿è¯
3. âœ… ä¾èµ–è§£æå¼ºå¤§ï¼Œé¿å…å†²çª
4. âœ… æ”¯æŒdevelopment/productionåˆ†ç»„ä¾èµ–
5. âœ… å‘½ä»¤è¡Œç›´è§‚æ˜“ç”¨

**å®‰è£…**:
```bash
curl -sSL https://install.python-poetry.org | python3 -

# æˆ–è€…
pip install poetry
```

**é¡¹ç›®åˆå§‹åŒ–**:
```bash
cd mywind-fastapi
poetry init

# pyproject.tomlä¼šè‡ªåŠ¨ç”Ÿæˆ
[tool.poetry]
name = "mywind-akshare-api"
version = "1.0.0"
description = "MyWind AkShare Data API for TradingAgents"
authors = ["Your Name <email@example.com>"]

[tool.poetry.dependencies]
python = "^3.11"
akshare = "1.18.7"
fastapi = "^0.109.0"
uvicorn = "^0.27.0"
redis = "^5.0.0"
pymongo = "^4.6.0"
pandas = "^2.1.0"
pydantic = "^2.5.0"

[tool.poetry.group.dev.dependencies]
pytest = "^7.4.0"
pytest-asyncio = "^0.23.0"
black = "^23.12.0"
ruff = "^0.1.9"
```

**ä½¿ç”¨**:
```bash
#å®‰è£…æ‰€æœ‰ä¾èµ–
poetry install

# åªå®‰è£…ç”Ÿäº§ä¾èµ–ï¼ˆéƒ¨ç½²æ—¶ï¼‰
poetry install --no-dev

# æ·»åŠ æ–°ä¾èµ–
poetry add requests

# æ›´æ–°ç‰¹å®šåŒ…
poetry update akshare

# æŸ¥çœ‹ä¾èµ–æ ‘
poetry show --tree
```

---

### 2. Dockeréƒ¨ç½²ç­–ç•¥

**å¤šé˜¶æ®µæ„å»º + ç‰ˆæœ¬é”å®š**:

```dockerfile
# Dockerfile
FROM python:3.11-slim as builder

# å®‰è£…Poetry
RUN pip install poetry==1.7.0

WORKDIR /app

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY pyproject.toml poetry.lock ./

# é…ç½®Poetryä¸åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆDockerå·²ç»æ˜¯éš”ç¦»ç¯å¢ƒï¼‰
RUN poetry config virtualenvs.create false

# å®‰è£…ä¾èµ–åˆ°ç³»ç»ŸPython
RUN poetry install --no-dev --no-root

# ç”Ÿäº§é•œåƒ
FROM python:3.11-slim

WORKDIR /app

# ä»builderå¤åˆ¶å®‰è£…å¥½çš„åŒ…
COPY --from=builder /usr/local/lib/python3.11/site-packages /usr/local/lib/python3.11/site-packages
COPY --from=builder /usr/local/bin /usr/local/bin

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY . .

# æš´éœ²ç«¯å£
EXPOSE 8888

# å¯åŠ¨å‘½ä»¤
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8888"]
```

**docker-compose.yml**:
```yaml
version: '3.8'

services:
  mywind-api:
    build: .
    ports:
      - "8888:8888"
    environment:
      - REDIS_URL=redis://redis:6379
      - MONGODB_URL=mongodb://mongo:27017
      - AKSHARE_VERSION=1.18.7  # è®°å½•ä½¿ç”¨çš„ç‰ˆæœ¬
    depends_on:
      - redis
      - mongo
    restart: unless-stopped
    
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
      
  mongo:
    image: mongo:7
    ports:
      - "27017:27017"
    volumes:
      - mongo-data:/data/db

volumes:
  mongo-data:
```

---

### 3. è‡ªåŠ¨åŒ–æµ‹è¯•ç­–ç•¥

**å…³é”®ï¼šContract Testingï¼ˆå¥‘çº¦æµ‹è¯•ï¼‰**

```python
# tests/akshare_integration/test_akshare_contracts.py
"""
æµ‹è¯•AkShareæ¥å£å¥‘çº¦ï¼ˆè¿”å›å­—æ®µã€æ•°æ®ç±»å‹ï¼‰
å¦‚æœAkShareæ›´æ–°åå­—æ®µå˜åŒ–ï¼Œæµ‹è¯•ä¼šå¤±è´¥
"""
import pytest
import akshare as ak
import pandas as pd

class TestStockHKContracts:
    """æ¸¯è‚¡è¡Œæƒ…æ¥å£å¥‘çº¦æµ‹è¯•"""
    
    def test_stock_hk_spot_em_returns_dataframe(self):
        """æµ‹è¯•è¿”å›DataFrame"""
        result = ak.stock_hk_spot_em()
        assert isinstance(result, pd.DataFrame)
    
    def test_stock_hk_spot_em_required_columns(self):
        """æµ‹è¯•å¿…éœ€å­—æ®µå­˜åœ¨"""
        result = ak.stock_hk_spot_em()
        required_columns = ["ä»£ç ", "åç§°", "æœ€æ–°ä»·", "æ¶¨è·Œé¢", "æ¶¨è·Œå¹…", "ä»Šå¼€", "æœ€é«˜", "æœ€ä½", "æˆäº¤é‡"]
        
        for col in required_columns:
            assert col in result.columns, f"Missing required column: {col}"
    
    def test_stock_hk_spot_em_data_types(self):
        """æµ‹è¯•æ•°æ®ç±»å‹"""
        result = ak.stock_hk_spot_em()
        
        # ä»·æ ¼åº”è¯¥æ˜¯æ•°å­—
        assert pd.api.types.is_numeric_dtype(result["æœ€æ–°ä»·"])
        # ä»£ç åº”è¯¥æ˜¯å­—ç¬¦ä¸²
        assert pd.api.types.is_string_dtype(result["ä»£ç "]) or pd.api.types.is_object_dtype(result["ä»£ç "])

# ä¸ºæ‰€æœ‰253ä¸ªæ¥å£ç¼–å†™å¥‘çº¦æµ‹è¯•
# è¿™æ ·AkShareæ›´æ–°åï¼Œå¦‚æœå­—æ®µå˜åŒ–ä¼šç«‹å³å‘ç°
```

**CI/CDé›†æˆ**:
```yaml
# .github/workflows/test.yml
name: Test AkShare Integration

on:
  pull_request:
  schedule:
    - cron: '0 0 * * *'  # æ¯å¤©æµ‹è¯•ä¸€æ¬¡

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install Poetry
        run: pip install poetry
      
      - name: Install dependencies
        run: poetry install
      
      - name: Run contract tests
        run: poetry run pytest tests/akshare_integration/ -v
      
      - name: Report failures
        if: failure()
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ job.status }}
          text: 'AkShare integration tests failed! Possible API changes.'
```

---

## ğŸ“‹ æœ€ç»ˆå»ºè®®æ–¹æ¡ˆ

### éƒ¨ç½²æ¶æ„æ¨è

```
ç¯å¢ƒåˆ†ç¦» + æ¸è¿›å¼æ›´æ–° + è‡ªåŠ¨åŒ–ç›‘æ§
```

| ç¯å¢ƒ | AkShareç‰ˆæœ¬ç­–ç•¥ | æ›´æ–°é¢‘ç‡ | æµ‹è¯•è¦æ±‚ |
|------|----------------|----------|----------|
| **Dev** | æ¿€è¿›ï¼ˆlatestï¼‰ | æ¯å‘¨ä¸€è‡ªåŠ¨ | è‡ªåŠ¨åŒ–æµ‹è¯• |
| **Staging** | ä¿å®ˆï¼ˆDevéªŒè¯é€šè¿‡ï¼‰ | æ¯2å‘¨ | å®Œæ•´å›å½’æµ‹è¯• |
| **Prod** | ä¸¥æ ¼é”å®š | æ¯æœˆ/ç´§æ€¥æ—¶ | å……åˆ†éªŒè¯+ç°åº¦å‘å¸ƒ |

### å…·ä½“å®æ–½æ­¥éª¤ï¼ˆ5æ­¥èµ°ï¼‰

#### Phase 1: å»ºç«‹åŸºç¡€ï¼ˆWeek 1ï¼‰
```bash
# 1. å®‰è£…Poetry
pip install poetry

# 2. åˆå§‹åŒ–é¡¹ç›®
cd mywind-fastapi
poetry init

# 3. æ·»åŠ AkShareï¼ˆé”å®šå½“å‰ç¨³å®šç‰ˆæœ¬ï¼‰
poetry add akshare==1.18.7

# 4. ç”Ÿæˆlockæ–‡ä»¶
poetry lock

# 5. æäº¤åˆ°Git
git add pyproject.toml poetry.lock
git commit -m "chore: add Poetry dependency management"
```

#### Phase 2: å»ºç«‹æµ‹è¯•ä½“ç³»ï¼ˆWeek 2ï¼‰
```bash
# 1. æ·»åŠ æµ‹è¯•ä¾èµ–
poetry add --group dev pytest pytest-asyncio pytest-cov

# 2. ç¼–å†™å¥‘çº¦æµ‹è¯•ï¼ˆè‡³å°‘è¦†ç›–P0çš„80ä¸ªæ¥å£ï¼‰
# tests/akshare_integration/test_*.py

# 3. é…ç½®CI
# .github/workflows/test.yml

# 4. é¦–æ¬¡è¿è¡Œæµ‹è¯•
poetry run pytest
```

#### Phase 3: å»ºç«‹ç›‘æ§ï¼ˆWeek 3ï¼‰
```bash
# 1. åˆ›å»ºç‰ˆæœ¬æ£€æŸ¥è„šæœ¬
# scripts/check_akshare_version.py

# 2. åˆ›å»ºå¥åº·æ£€æŸ¥
# services/akshare_health_checker.py

# 3. é…ç½®cron jobæ¯å°æ—¶è¿è¡Œ
0 * * * * cd /app && poetry run python services/akshare_health_checker.py

# 4. é…ç½®å‘Šè­¦ï¼ˆSlack/Email/é’‰é’‰ï¼‰
```

#### Phase 4: å»ºç«‹æ›´æ–°æµç¨‹ï¼ˆWeek 4ï¼‰
```bash
# 1. æ–‡æ¡£åŒ–æ›´æ–°SOP
# docs/AKSHARE_UPDATE_PROCEDURE.md

# 2. é…ç½®è‡ªåŠ¨æ›´æ–°PRï¼ˆDevç¯å¢ƒï¼‰
# .github/workflows/update-akshare.yml

# 3. å‡†å¤‡å›æ»šè„šæœ¬
# scripts/rollback_akshare.sh
```

#### Phase 5: æŒç»­ä¼˜åŒ–ï¼ˆOngoingï¼‰
- æ¯å‘¨review Devç¯å¢ƒæµ‹è¯•ç»“æœ
- æ¯2å‘¨è¯„ä¼°æ˜¯å¦æ›´æ–°Staging
- æ¯æœˆå›ºå®šçª—å£æ›´æ–°Productionï¼ˆé™¤éç´§æ€¥ï¼‰
- æŒç»­è¡¥å……æµ‹è¯•ç”¨ä¾‹

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒåŸåˆ™
1. **ä¸è¦å®³æ€•æ›´æ–°** - AkShareå¿…é¡»ä¿æŒæ›´æ–°æ‰èƒ½æ­£å¸¸å·¥ä½œ
2. **ä½†è¦ç§‘å­¦åœ°æ›´æ–°** - é€šè¿‡æµ‹è¯•ã€åˆ†ç¯å¢ƒã€æ¸è¿›å¼å‘å¸ƒé™ä½é£é™©
3. **è‡ªåŠ¨åŒ–æ˜¯å…³é”®** - ç›‘æ§ã€æµ‹è¯•ã€éƒ¨ç½²éƒ½è¦è‡ªåŠ¨åŒ–
4. **å¿«é€Ÿå“åº”èƒ½åŠ›** - å»ºç«‹ç´§æ€¥æ›´æ–°é€šé“ï¼Œå…³é”®æ¥å£å¤±æ•ˆ24å°æ—¶å†…ä¿®å¤

### æ¨èé…ç½®ï¼ˆTL;DRï¼‰

**ä¾èµ–ç®¡ç†**: Poetry  
**ç‰ˆæœ¬ç­–ç•¥**: ç”Ÿäº§ç¯å¢ƒé”å®šç‰ˆæœ¬ (`akshare==1.18.7`)  
**æ›´æ–°é¢‘ç‡**: 
- Dev: æ¯å‘¨è‡ªåŠ¨
- Staging: æ¯2å‘¨æ‰‹åŠ¨
- Prod: æ¯æœˆå›ºå®šçª—å£ + ç´§æ€¥çƒ­ä¿®å¤

**ç›‘æ§**: æ¯å°æ—¶å¥åº·æ£€æŸ¥ + æ¯å¤©ç‰ˆæœ¬æ£€æŸ¥  
**æµ‹è¯•**: 253ä¸ªæ¥å£çš„å¥‘çº¦æµ‹è¯•

### ç«‹å³è¡ŒåŠ¨æ¸…å•

- [ ] å®‰è£…Poetry
- [ ] åˆ›å»ºpyproject.tomlé”å®šakshare==1.18.7
- [ ] ç¼–å†™å‰20ä¸ªP0æ¥å£çš„å¥‘çº¦æµ‹è¯•
- [ ] é…ç½®GitHub Actions CI
- [ ] åˆ›å»ºå¥åº·æ£€æŸ¥è„šæœ¬
- [ ] æ–‡æ¡£åŒ–æ›´æ–°æµç¨‹

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2026-01-06  
**ä¸‹ä¸€æ­¥**: å¼€å§‹Phase 1 - å»ºç«‹Poetryä¾èµ–ç®¡ç†
