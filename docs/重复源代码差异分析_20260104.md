# 重复源代码差异分析报告

**日期**: 2026-01-04 14:42  
**分析对象**: 27个重复源代码

---

## 📊 核心发现

**两份代码功能完全不同，不是重复！**

| 位置 | 功能定位 | 使用场景 |
|------|----------|----------|
| **scrapers/*.js** | 通用首页采集 | 全量采集：抓取网站首页最新新闻 |
| **stockNewsCollector.js** | 定向个股搜索 | 订阅采集：搜索特定股票相关新闻 |

---

## 🔍 详细对比（4个样本）

### 1. AAStocks

| 对比项 | scrapers/aastocks.js | stockNewsCollector.js |
|--------|---------------------|----------------------|
| URL | `http://www.aastock.com/sc/stocks/news/aafn` | `http://www.aastocks.com/sc/stocks/analysis/stock-aafn/{code}` |
| 功能 | 采集通用新闻首页 |采集**个股新闻页面** |
| 选择器 | `.newshead4 a, .news-item a` | `a[href*="news"]` |
| 输入参数 | 无（通用） | `stockCode, stockName` |

### 2. 富途 (Futu)

| 对比项 | scrapers/futu.js | stockNewsCollector.js |
|--------|------------------|---------------------|
| URL | `https://news.futunn.com/main` | `https://news.futunn.com/main/live` |
| 功能 | 采集主页文章列表 | 采集实时快讯+关键词过滤 |
| 选择器 | `a[href*="/post/"]` | `.flash-list__flash-item` |
| 过滤逻辑 | 无 | ✅ **按股票名关键词过滤** |
| 兜底策略 | 无 | ✅ **无匹配时返回最新快讯** |

### 3. 格隆汇 (Gelonghui)

| 对比项 | scrapers/gelonghui.js | stockNewsCollector.js |
|--------|---------------------|----------------------|
| URL | `https://www.gelonghui.com/` | `https://www.gelonghui.com/search?keyword={keyword}&type=live` |
| 功能 | 采集首页文章 | **搜索页关键词查询** |
| 处理方式 | 滚动加载 | 搜索API |
| 关键差异 | 首页随机内容 | ✅ **精准搜索结果** |

### 4. 同花顺 (THS)

| 对比项 | scrapers/ths.js | stockNewsCollector.js |
|--------|----------------|---------------------|
| URL | `https://news.10jqka.com.cn/tapp/news/push/stock/` | `https://search.10jqka.com.cn/unifiedwap/search/search/indexSearch?keyword={keyword}` |
| 功能 | HTTP API 7x24快讯 | **搜索API + 关键词查询** |
| 方法 | HTTP + 备用Puppeteer | Puppeteer |
| 定向性 | 无 | ✅ **按股票名搜索** |

---

## ✅ 结论

### 两份代码都需要保留！

**原因**：

1. **功能互补**：
   - `scrapers/*.js`：适合**全量采集**（发现新闻、行业动态）
   - `stockNewsCollector.js`：适合**订阅采集**（用户关心的股票）

2. **调度策略不同**：
   - 全量采集：每15-30分钟，获取市场最新动态
   - 定向采集：每10-30分钟，只采集订阅股票

3. **数据质量不同**：
   - 全量采集：数据多但杂，需要关键词过滤匹配
   - 定向采集：**精准度高**，100%相关

---

## 🔧 建议

### 不要删除，要明确分工

| 采集任务 | 使用哪份代码 | 调度频率 |
|----------|--------------|----------|
| 市场全量扫描 | scrapers/*.js | 每30分钟 |
| 订阅股票定向 | stockNewsCollector.js | 每10分钟 |

### 需要解决的问题

1. **命名混淆**：
   - `scrapers/futu.js` 的函数叫 `scrapeFutu()`
   - `stockNewsCollector.js` 的函数叫 `scrapeFutuForStock()`
   - 建议重命名clarify用途

2. **调度器未调用**：
   - 两套代码都没有完全接入调度器
   - 需要整合到调度系统

---

## 📝 总结

**27个"重复源"实际不是重复，是两种采集模式：**

- ❌ 错误理解：代码重复，浪费维护成本
- ✅ 正确理解：功能互补，分别用于全量和定向采集

**下一步应该做什么？**

不是删除重复代码，而是：
1. 明确两套系统的分工
2. 分别接入调度器
3. 测试两种采集效果
