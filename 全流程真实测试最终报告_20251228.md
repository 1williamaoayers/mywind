# MyWind 全流程真实测试最终报告

**测试时间**：2025-12-28 17:44 - 17:55  
**测试环境**：192.168.3.134  
**测试结果**：✅ 全流程验证成功

---

## 一、测试结果摘要

| 指标 | 数值 | 说明 |
|------|------|------|
| 爬虫总数 | 30 个 | 覆盖港股/A股/美股/海外 |
| 采集成功 | **22 个 (73%)** | 使用 Puppeteer 真实采集 |
| 采集失败 | 8 个 | 详见失败分析 |
| 原始数据 | **383 条** | 全部信息源采集 |
| 过滤后入库 | **143 条 (37%)** | 应用修复后的过滤规则 |
| 订阅匹配 | 75 条* | *存在关键词配置错误 |

---

## 二、爬虫采集详情

### 高优先级信息源（港股专属）- 8 个

| 信息源 | 状态 | 采集数量 | 耗时 | 采集方式 |
|--------|------|----------|------|----------|
| **AAStocks** | ✅ 成功 | 20 条 | 21s | Puppeteer |
| **ETNet 经济通** | ✅ 成功 | 20 条 | 19s | Puppeteer |
| **格隆汇** | ✅ 成功 | 20 条 | 14s | Puppeteer |
| **富途** | ✅ 成功 | 20 条 | 11s | Puppeteer |
| **港交所** | ✅ 成功 | 4 条 | 30s | Puppeteer |
| **信报 HKEJ** | ✅ 成功 | 20 条 | 10s | Puppeteer |
| 智通财经 | ❌ 失败 | 0 条 | 15s | WAF 拦截 |
| 香港经济日报 | ❌ 失败 | 0 条 | 11s | 页面变化 |

**港股信息源成功率**：6/8 (75%)

### 普通优先级信息源（A股/综合）- 15 个

| 信息源 | 状态 | 采集数量 | 耗时 | 采集方式 |
|--------|------|----------|------|----------|
| **金十数据** | ✅ 成功 | 20 条 | 3s | HTTP+代理 |
| **同花顺** | ✅ 成功 | 20 条 | 5s | Puppeteer |
| **证券时报** | ✅ 成功 | 20 条 | 10s | Puppeteer |
| **第一财经** | ✅ 成功 | 16 条 | 11s | Puppeteer |
| **每日经济新闻** | ✅ 成功 | 20 条 | 8s | Puppeteer |
| **界面新闻** | ✅ 成功 | 20 条 | 11s | Puppeteer |
| **36氪** | ✅ 成功 | 20 条 | 15s | Puppeteer |
| **集微网** | ✅ 成功 | 9 条 | 24s | Puppeteer |
| **Yahoo Finance** | ✅ 成功 | 16 条 | 12s | Puppeteer |
| **SEC EDGAR** | ✅ 成功 | 20 条 | 3s | HTTP |
| **微博热搜** | ✅ 成功 | 20 条 | 21s | Puppeteer |
| **淘股吧** | ✅ 成功 | 2 条 | 12s | Puppeteer |
| **腾讯财经** | ✅ 成功 | 16 条 | 14s | Puppeteer |
| 北向资金 | ❌ 失败 | 0 条 | 16s | 周末无数据 |
| 东方财富研报 | ❌ 失败 | 0 条 | - | 函数加载错误 |

### 低优先级信息源（海外/研报）- 7 个

| 信息源 | 状态 | 采集数量 | 耗时 |
|--------|------|----------|------|
| **Seeking Alpha** | ✅ 成功 | 20 条 | 2s |
| **全球媒体** | ✅ 成功 | 20 条 | 14s |
| **研报客** | ✅ 成功 | 20 条 | 18s |
| 发现报告 | ❌ 失败 | 0 条 | 20s |
| 互动易 | ❌ 失败 | 0 条 | - |
| 微信搜索 | ❌ 失败 | 0 条 | - |
| 知乎 | ⚠️ 跳过 | - | - |

---

## 三、过滤规则验证

### 修复后的过滤规则

> ✅ **核心修复**：P0 来源不再绕过订阅检查

```javascript
// 修复前：P0来源直接入库
if (priority === 'P0') {
    result.score = this.calculateScore(item);
    return result;  // 完全绕过订阅匹配！
}

// 修复后：P0来源也检查订阅匹配
if (stockMatch.matched) {
    result.score = 100;  // 匹配订阅 → 满分
} else if (this.matchWhitelist(text)) {
    result.score = this.calculateScore(item) - 20;  // 匹配白名单 → 降分
} else {
    result.keep = false;  // 不相关 → 不入库
}
```

### 过滤结果统计

| 过滤结果 | 数量 | 占比 |
|----------|------|------|
| 原始采集 | 383 条 | 100% |
| 保留入库 | 143 条 | 37% |
| 过滤丢弃 | 240 条 | 63% |
| 订阅匹配 | 75 条* | 19% |

> ⚠️ *订阅匹配 75 条存在误匹配问题（见下文诊断）

### 入库数据来源分布

| 来源 | 入库数量 |
|------|----------|
| aastocks | 14 条 |
| hkej | 5 条 |
| etnet | 11 条 |
| gelonghui | 4 条 |
| futu | 6 条 |
| hkex | 4 条 |
| jin10 | 12 条 |
| ths | 16 条 |
| sec | 15 条 |
| ... | ... |

---

## 四、问题诊断与修复

### 发现的严重问题

**关键词配置错误**：京东的订阅关键词包含单字符 `'r'`

```json
// 错误配置（已修复）
{
  "stockCode": "09618",
  "stockName": "京东集团",
  "keywords": ["09618", "09618.HK", "京东集团", "京东", "r"]  // ← 'r' 是错误的！
}
```

**影响**：几乎所有英文内容都包含字母 'r'，导致 75 条"订阅匹配"全部是误匹配。

### 已完成的修复

1. **过滤规则修复** (`utils/dataFilter.js`)
   - P0 来源现在也会检查订阅匹配
   - 增加 `subscriptionManager` 参数
   - 返回 `relatedStocks` 字段

2. **关键词配置修复** (`data/subscriptions.json`)
   - 移除错误的 `'r'`
   - 添加正确的英文关键词 `'JD.com'` 和 `'JD'`

---

## 五、真实采集数据示例

### 港股信息源采集的真实新闻

| 来源 | 标题 | 评分 |
|------|------|------|
| AAStocks | 港股三连升 Lemon公开百万仓位！ | 40 |
| AAStocks | 騰訊回購105.6萬股 涉資6.36億元 | 60 |
| ETNet | 恒生私有化兩大投票顧問籲股東支持 | 60 |
| ETNet | 平安資管增持招行510萬股H股 | 60 |
| 格隆汇 | 财政部：明年扩大财政支出盘子 | 50 |
| 富途 | 财政部：2026年大力提振消费 | 45 |
| 信报 | 陳茂波：經濟可望保持良好勢頭 | 55 |
| 港交所 | 2026年第一次臨時股東大會 | 50 |

### A股/综合信息源采集的真实新闻

| 来源 | 标题 |
|------|------|
| 金十 | 恒瑞医药：与翰森制药签署独家许可协议 |
| 金十 | 重庆追加汽车置换、汽车报废更新补贴 |
| 同花顺 | 贵州茅台董事长陈华：尽最大努力防止价格炒作 |
| 证券时报 | 通业科技：拟5.61亿元购买思凌科股份 |
| 微博 | 2025年最后一周开始了 |

---

## 六、数据存储验证

### MongoDB 验证

```bash
$ mongo private_wind --eval "db.news.countDocuments()"
143
```

| 字段 | 示例值 |
|------|--------|
| _id | 6950f5f0... |
| title | 騰訊回購105.6萬股 涉資6.36億元 |
| source | aastocks |
| score | 60 |
| filterReason | p1_whitelist |
| relatedStocks | [] |
| createdAt | 2025-12-28T09:49:36.987Z |

### 存储位置

| 类型 | 路径 |
|------|------|
| MongoDB 数据库 | `mongodb://127.0.0.1:27017/private_wind` |
| MongoDB 数据文件 | `/anti/mywind/data/mongodb/` |
| 测试结果 JSON | `/anti/mywind/full-e2e-test-result.json` |

---

## 七、结论与建议

### ✅ 验证通过

1. **Puppeteer 采集能力**：22/30 爬虫成功，使用 Puppeteer 进行真实浏览器采集
2. **港股信息源**：6/8 港股专属源成功（AAStocks、ETNet、格隆汇、富途、港交所、信报）
3. **过滤规则**：修复后正确应用，过滤率 63%
4. **MongoDB 入库**：143 条数据成功入库

### ⚠️ 待改进

| 问题 | 解决方案 |
|------|----------|
| 智通财经 WAF 拦截 | 增加反检测措施或更换 IP |
| 香港经济日报页面变化 | 更新选择器 |
| 关键词配置验证 | 添加关键词长度检查（≥2字符） |
| 订阅匹配准确性 | 需要在修复关键词后重新测试 |

### 📋 后续行动

1. **重新运行测试**：关键词修复后重新验证订阅匹配
2. **修复失败爬虫**：zhitong、hket、northbound 等
3. **配置飞书推送**：设置 `FEISHU_WEBHOOK` 环境变量
4. **持续采集**：启动 `smartSchedulerService` 进行定时采集

---

*报告生成时间：2025-12-28 17:58*  
*测试脚本：/anti/mywind/full-e2e-test.js*
