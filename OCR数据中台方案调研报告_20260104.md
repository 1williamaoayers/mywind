# MyWind 数据中台方案调研报告（基于项目运转预估）

**调研日期**: 2026-01-04  
**分析依据**: 项目调度配置 + 爬虫设计 + 订阅配置

---

## 一、项目运转后数据量预估

### 1.1 采集频率分析

根据 `schedulerService.js` 配置：

| 任务 | 频率 | 每日执行次数 |
|------|------|-------------|
| 实时采集 | 每5分钟 | 288次 |
| 深度采集 | 每30分钟 | 48次 |
| 搜索引擎增强 | 每30分钟 | 48次 |
| 视觉采集(OCR) | 每6小时 | 4次 |
| 政策哨兵 | 每2小时 | 12次 |
| 另类数据 | 每小时 | 24次 |
| 格隆汇 | 每10分钟 | 144次 |
| 腾讯财经 | 每2分钟 | 720次 |

### 1.2 爬虫规模

- **爬虫总数**: 32个
- **每次采集上限**: 20-30条/源
- **订阅股票**: 4只 (京东、小米、联塑、禾赛)

### 1.3 新闻数据量预估

```
每日新闻采集量 (保守估计):
├── 实时采集: 288次 × 10源 × 5条/源 = 14,400 条/日
├── 深度采集: 48次 × 5源 × 10条/源 = 2,400 条/日
├── 搜索引擎: 48次 × 3条 = 144 条/日
├── 格隆汇: 144次 × 5条 = 720 条/日
└── 腾讯财经: 720次 × 3条 = 2,160 条/日
                              ─────────────────
                              约 20,000 条/日 (去重前)
                              
去重后预估: 约 5,000 条/日 (重复率约75%)
```

**年度新闻数据量**:
| 指标 | 数值 |
|------|------|
| 日均新增 | ~5,000 条 |
| 月均新增 | ~150,000 条 |
| **年度新增** | **~1,800,000 条 (180万)** |
| 单条平均大小 | ~5KB (含全文) |
| **年度存储** | **~9 GB** |

### 1.4 PDF/公告数据量预估

```
PDF来源:
├── 港交所披露易: 4股票 × 50份公告/股票/年 = 200份/年
├── 同花顺公告: 4股票 × 100份/股票/年 = 400份/年
├── 研报(东财等): 4股票 × 30份研报/股票/年 = 120份/年
└── 其他来源: 约50份/年
                              ─────────────────
                              约 770 份PDF/年

假设未来扩展到20只股票:
├── 770 × 5 = 3,850 份PDF/年
```

**年度PDF数据量**:
| 规模 | 数量 | 存储 | OCR文本 |
|------|------|------|---------|
| 当前(4只股票) | ~770份/年 | ~500MB | ~100MB |
| 扩展(20只股票) | ~3,850份/年 | ~2.5GB | ~500MB |
| 扩展(50只股票) | ~10,000份/年 | ~6GB | ~1.2GB |

### 1.5 总数据量汇总

| 时间维度 | 新闻(条) | PDF(份) | 存储容量 |
|----------|----------|---------|----------|
| **1年** | 180万 | 770 | ~10 GB |
| **3年** | 540万 | 2,310 | ~30 GB |
| **5年** | 900万 | 3,850 | ~50 GB |

> [!IMPORTANT]
> **关键发现**：项目运转1年后将积累约**180万条新闻**和**770份PDF**。
> 这个数据量**需要向量检索**才能高效利用！

---

## 二、核心问题分析

### 2.1 现有系统瓶颈

| 问题 | 影响 | 紧迫度 |
|------|------|--------|
| **OCR质量差(22%)** | PDF内容无法提取，AI无法分析 | 🔴 致命 |
| **无向量检索** | 180万条新闻无法高效查询 | 🔴 严重 |
| **MongoDB无索引** | 全文检索效率低 | 🟡 中等 |

### 2.2 DeepSeek分析需求

```
当前: 全量投喂 → 无法实现 (180万条 × 5KB = 9GB文本)
需要: RAG检索 → 仅投喂Top-K相关文档
```

**RAG必要性分析**:
| 场景 | 数据量 | 是否需要RAG |
|------|--------|-------------|
| 当前(23个PDF) | 27MB | ❌ 不需要 |
| **1年后** | 10GB | ✅ **必须** |
| 3年后 | 30GB | ✅ 必须 |

---

## 三、最优方案推荐

> [!TIP]
> **结论**：考虑项目长期运转，**需要完整的OCR+RAG中台**，但应分阶段实施。

### 推荐架构

```
┌────────────────────────────────────────────────────────────────┐
│                    MyWind 数据中台架构                          │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│  │   MyWind    │    │  OCR服务    │    │  RAG服务    │        │
│  │  (Node.js)  │───►│  (Python)   │───►│  (Python)   │        │
│  │             │    │             │    │             │        │
│  │ • 采集调度  │    │ • RapidOCR  │    │ • ChromaDB  │        │
│  │ • MongoDB   │    │ • RapidTable│    │ • Embedding │        │
│  │ • 业务逻辑  │    │ • Markdown  │    │ • 语义检索  │        │
│  └─────────────┘    └─────────────┘    └─────────────┘        │
│         │                  │                  │               │
│         └──────────────────┴──────────────────┘               │
│                            │                                  │
│                    ┌───────▼───────┐                          │
│                    │   DeepSeek    │                          │
│                    │   API分析     │                          │
│                    └───────────────┘                          │
└────────────────────────────────────────────────────────────────┘
```

### 分阶段实施计划

#### 阶段一：OCR服务 (2天) 🔴 紧急

**目标**: 解决22%置信度的致命问题

```
创建: /opt/ocr-service/
├── server.py          # FastAPI + RapidOCR
├── requirements.txt   # rapidocr-onnxruntime, rapid-table
└── Dockerfile

API:
POST /ocr/image  → 图片识别
POST /ocr/pdf    → PDF识别(含表格)
```

**内存预估**: +300MB  
**预期效果**: OCR置信度 22% → 85%+

#### 阶段二：RAG检索服务 (3天) 🟡 重要

**目标**: 为180万条新闻提供语义检索能力

```
扩展: /opt/ocr-service/ → /opt/data-hub/
├── server.py          # FastAPI
├── ocr_service.py     # OCR功能
├── rag_service.py     # RAG功能
├── vector_db/         # ChromaDB存储
└── requirements.txt   # + chromadb, text2vec

API:
POST /index    → 索引新文档
POST /search   → 语义检索 (返回Top-K)
POST /analyze  → 检索+DeepSeek分析
```

**内存预估**: +500MB (总计~800MB)  
**磁盘预估**: 向量索引约 1GB/百万条

#### 阶段三：全量数据迁移 (1天)

**目标**: 将MongoDB历史数据同步到向量库

```javascript
// 迁移脚本
for (const news of allNews) {
  await axios.post('http://localhost:9000/index', {
    id: news._id,
    content: news.content,
    metadata: { source: news.source, date: news.publishTime }
  });
}
```

---

## 四、资源评估

### 内存规划

| 组件 | 当前占用 | 新增占用 | 总计 |
|------|----------|----------|------|
| 系统+服务 | 2.1GB | - | 2.1GB |
| OCR服务 | - | +300MB | 2.4GB |
| RAG服务 | - | +500MB | 2.9GB |
| **总计** | - | +800MB | **2.9GB** |
| **可用** | 1.7GB | -0.8GB | **0.9GB** |

> [!WARNING]
> 内存较紧张，但有3.9GB Swap可用，可以运行。
> 建议：OCR/RAG服务设置内存限制，避免OOM。

### 磁盘规划

| 数据类型 | 1年 | 3年 | 可用空间 |
|----------|-----|-----|----------|
| 新闻文本 | 9GB | 27GB | 92GB ✅ |
| PDF文件 | 0.5GB | 1.5GB | - |
| 向量索引 | 2GB | 6GB | - |
| **总计** | 11.5GB | 34.5GB | 92GB ✅ |

---

## 五、与用户提供方案的对比

| 维度 | 用户方案 | 推荐方案 | 说明 |
|------|----------|----------|------|
| OCR引擎 | RapidOCR ✅ | RapidOCR ✅ | 一致 |
| 向量库 | ChromaDB ✅ | ChromaDB ✅ | 一致 |
| Worker模式 | 独立后台进程 | 按需调用 | 简化 |
| 文件监控 | inotify监控目录 | HTTP触发 | 集成MyWind |
| 部署方式 | Systemd | Docker | 与现有一致 |

> [!TIP]
> **核心差异**：用户方案是独立系统，推荐方案是**集成到MyWind**。
> 不创建独立的OCR Worker，而是让MyWind采集器直接调用OCR API。

---

## 六、结论

| 问题 | 答案 |
|------|------|
| **是否需要OCR升级？** | ✅ **必须**，22%置信度无法使用 |
| **是否需要RAG？** | ✅ **必须**，1年后180万条数据 |
| **采用用户方案？** | 🟡 **部分采用**，核心技术一致，架构简化 |
| **最优方案** | 分两阶段：先OCR(2天) → 再RAG(3天) |
| **总工作量** | 5天 |
| **内存增加** | +800MB |

---

## 七、下一步

请确认是否按此方案执行：

1. **阶段一(紧急)**: 创建Python OCR微服务，解决PDF提取问题
2. **阶段二(重要)**: 添加ChromaDB向量检索，支持海量数据语义搜索
3. **阶段三**: 迁移历史数据到向量库
